(function(){'use strict';var e=Math.min;function a(){console.log(f,"font-weight: bold; color: #fa066b",...arguments)}function b(){console.warn(f,"font-weight: bold; color: #fa066b",...arguments)}function c(b,c){c===void 0&&(c="");let d="";for(let a=0,e=b.length;a<e;a++)d+=b[a].toString(16).padStart(2,"0").toUpperCase()+" ";a(c,d)}function d(a){let b=new Uint8Array([(4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a]),c=[];for(let d=0;4>d;d++)(0!==b[d]||c.length)&&c.push(b[d]);return c}const f="%c WebM Parser:",g="master",h="uint",i="bin";class j{constructor(a,b){this.value=a,this.bytesCount=b,this.bytes=[]}static parse(a){let c=e(a.length,8),d="";for(let b=0;b<c;b++)d+=a[b].toString(2).padStart(8,"0");return"0000000111111111111111111111111111111111111111111111111111111111"===d?new j(-1,8):8===d.length||"1"===d[0]?new j(parseInt("0"+d.slice(1,8),2),1):16===d.length||"1"===d[1]?new j(parseInt("00"+d.slice(2,16),2),2):24===d.length||"1"===d[2]?new j(parseInt("000"+d.slice(3,24),2),3):32===d.length||"1"===d[3]?new j(parseInt("0000"+d.slice(4,32),2),4):"1"===d[4]?new j(parseInt("00000"+d.slice(5,40),2),5):(b("Unable to parse VInt ("+d+")"),new j(parseInt(d,2),a.length))}static createBytes(a){var c=Math.pow;if(0>a||a>c(2,53))throw new Error("Unrepresentable value: "+a);for(var d=1;8>=d&&!(a<c(2,7*d)-1);d++);for(var e,f=new Uint8Array(d),g=1;g<=d;g++)e=255&a,f[d-g]=e,a-=e,a/=c(2,8);return f[0]|=1<<8-d,f}}class k{constructor(a,b){Object.defineProperty(this,"_name",{enumerable:!1,writable:!0,value:a.slice(0,1).toLowerCase()+a.slice(1)}),Object.defineProperty(this,"_type",{enumerable:!1,writable:!0,value:b||WebM.TYPE_UINT}),Object.defineProperty(this,"_position",{enumerable:!1,writable:!0,value:void 0}),Object.defineProperty(this,"_length",{enumerable:!1,writable:!0,value:void 0}),Object.defineProperty(this,"_contentLength",{enumerable:!1,writable:!0,value:void 0}),Object.defineProperty(this,"_availableElements",{enumerable:!1,writable:!0,value:[]}),Object.defineProperty(this,"is"+a,{enumerable:!1,writable:!0,value:!0}),Object.defineProperty(this,"EBML_ID",{enumerable:!1,writable:!0,value:[]})}parse(d,f,k){a("Parsing "+this._name+" ..."),void 0===f&&(f=0),void 0===k&&(k=!1);let l=e(this.EBML_ID.length,d.length-f);try{if(l<this.EBML_ID.length)throw"Unable to parse "+this._name+": Too few bytes";for(let a=0,b=this.EBML_ID.length;a<b;a++)if(d[f+a]!==this.EBML_ID[a])throw"Unable to parse "+this._name+": ID doesn't match"}catch(a){if(!k){c(d.slice(f-10,f+10));let e=[],g=[];for(let a=0;a<l;a++)e.push(d[f+a].toString(16).toUpperCase());for(let a=0;a<this.EBML_ID.length;a++)g.push(this.EBML_ID[a].toString(16).toUpperCase());b(a,"Given: ["+e.join(" "),"]   ID: [",g.join(" ")+"]")}return!1}this._position=f-1,0>this._position&&(this._position=0),f+=this.EBML_ID.length;let m=j.parse(d.slice(f,f+8));f+=m.bytesCount,this._contentLength=m.value,this._length=this.EBML_ID.length+m.bytesCount+(0<=m.value?m.value:0);let n=0<=m.value?m.value:d.length-f;switch(this._type){case"string":this.value=new TextDecoder("utf-8").decode(d.slice(f,f+n));break;case"int":this.value=j.parse(d.slice(f,f+n)).value;break;case h:this.value=j.parse(d.slice(f,f+n)).value;break;case i:this.value=d.slice(f,f+n);break;case g:let a=this._availableElements.slice(0),b=0;do{b=0;for(let c,e=0,g=a.length;e<g;e++)if(c=new a[e],c.parse(d,f,!0)){a.splice(e,1).slice(0),this[c._name]=c,f+=c._length,0>this._contentLength&&0<c._length&&(this._length+=c._length),b++;break}}while(0<b&&0<a.length);}return this.onParsingDone(d,f),!0}onParsingDone(a,b){}parseChildren(b,c,d,e){a("Parsing children ("+c.name+")");do{let a=new c;if(a.parse(d,e,!0)){e+=a._length,this._length+=a._length,this[b].push(a);continue}break}while(!0)}}class l extends k{constructor(){super("Header",g),this._availableElements=[m,n,o],this.EBML_ID=[26,69,223,163]}}class m extends k{constructor(){super("Version",h),this.value=void 0,this.EBML_ID=[66,134]}}class n extends k{constructor(){super("ReadVersion",h),this.value=void 0,this.EBML_ID=[66,247]}}class o extends k{constructor(){super("MaxIDLength",h),this.value=void 0,this.EBML_ID=[66,242]}}class p extends k{constructor(){super("SeekHead",g),this.seeks=[],this.EBML_ID=[17,77,155,116]}onParsingDone(a,b){this.parseChildren("seeks",q,a,b)}}class q extends k{constructor(){super("Seek",g),this._availableElements=[r,s],this.EBML_ID=[77,187]}}class r extends k{constructor(){super("SeekId",i),this.EBML_ID=[83,171]}}class s extends k{constructor(){super("SeekPosition",h),this.EBML_ID=[83,172]}}class t extends k{constructor(){super("Tracks",g),this.entries=[],this.EBML_ID=[22,84,174,107]}onParsingDone(a,b){this.parseChildren("entries",u,a,b)}}class u extends k{constructor(){super("TrackEntry",g),this._availableElements=[w,v,x,y],this.EBML_ID=[174]}}class v extends k{constructor(){super("TrackUID",h),this.EBML_ID=[115,197]}}class w extends k{constructor(){super("TrackNumber",h),this.EBML_ID=[215]}}class x extends k{constructor(){super("Video",g),this.EBML_ID=[224]}}class y extends k{constructor(){super("Audio",g),this.EBML_ID=[225]}}class z extends k{constructor(){super("Cues",g),this.EBML_ID=[28,83,187,107]}}class A extends k{constructor(){super("Cluster",g),this._availableElements=[B],this.simpleBlocks=[],this.EBML_ID=[31,67,182,117]}onParsingDone(a,b){this.parseChildren("simpleBlocks",C,a,b)}regenerateBytes(){let a=0,c=this.EBML_ID.length;c+=this.timestamp._length;for(let a=0,b=this.simpleBlocks.length;a<b;a++)c+=this.simpleBlocks[a]._length;let d=new Uint8Array(c);for(let b=0,c=this.EBML_ID.length;b<c;b++)d[a++]=this.EBML_ID[b];d[a++]=1,d[a++]=255,d[a++]=255,d[a++]=255,d[a++]=255,d[a++]=255,d[a++]=255,d[a++]=255;for(let b=0,c=this.timestamp.EBML_ID.length;b<c;b++)d[a++]=this.timestamp.EBML_ID[b];let b=j.createBytes(this.timestamp._contentLength);for(let c=0;c<b.length;c++)d[a++]=b[c];let e=WebM.intToBytes(this.timestamp.value);for(let b=0;b<e.length;b++)d[a++]=e[b];for(let b,c=0,e=this.simpleBlocks.length;c<e;c++){b=this.simpleBlocks[c];for(let c=0,e=b.EBML_ID.length;c<e;c++)d[a++]=b.EBML_ID[c];let e=j.createBytes(b._contentLength);for(let b=0;b<e.length;b++)d[a++]=e[b];for(let c=0,e=b.value.length;c<e;c++)d[a++]=b.value[c]}return d}}class B extends k{constructor(){super("Timestamp",h),this.EBML_ID=[231]}setValue(a){this.value=a,this._contentLength=Math.max(d(a).length,1),this._length=this.EBML_ID.length+1+this._contentLength}}class C extends k{constructor(){super("SimpleBlock",i),this.EBML_ID=[163]}}class D extends k{constructor(){super("Segment",g),this._availableElements=[p,E,t,z],this.clusters=[],this.EBML_ID=[24,83,128,103]}onParsingDone(a,b){this.parseChildren("clusters",A,a,b)}getLastCluster(){return this.clusters[this.clusters.length-1]}}class E extends k{constructor(){super("SegmentInfo",g),this._availableElements=[F],this.EBML_ID=[21,73,169,102]}}class F extends k{constructor(){super("SegmentUID",i),this.EBML_ID=[115,164]}}window.WebM=class{constructor(){this.header=new l,this.segment=new D}parse(b){a("Started..."),this.header.parse(b),this.header._length&&this.segment.parse(b,this.header._length)}},window.WebMHeader=l,window.WebMSegment=D,window.WebMCluster=A})();
//# sourceMappingURL=webm-parser.min.js.map
