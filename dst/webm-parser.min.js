(function(){'use strict';function a(){console.log(d,"font-weight: bold; color: #fa066b",...arguments)}function b(){console.warn(d,"font-weight: bold; color: #fa066b",...arguments)}function c(a,b){b===void 0&&(b="");let c="";for(let d=0,e=a.length;d<e;d++)c+=a[d].toString(16).padStart(2,"0").toUpperCase()+" ";WebM.log(b,c)}const d="%c WebM Parser:",e="master",f="uint",g="bin";class h{constructor(a,b){Object.defineProperty(this,"_name",{enumerable:!1,value:a.slice(0,1).toLowerCase()+a.slice(1)}),Object.defineProperty(this,"_type",{enumerable:!1,value:b||WebM.TYPE_UINT}),Object.defineProperty(this,"_position",{enumerable:!1,value:void 0}),Object.defineProperty(this,"_length",{enumerable:!1,value:void 0}),Object.defineProperty(this,"_contentLength",{enumerable:!1,value:void 0}),Object.defineProperty(this,"_availableElements",{enumerable:!1,value:[]}),Object.defineProperty(this,"is"+a,{enumerable:!1,value:!0}),Object.defineProperty(this,"EBML_ID",{enumerable:!1,value:[]})}parse(d,f,g){var h=Math.min;a("Parsing "+this._name+" ..."),void 0===f&&(f=0),void 0===g&&(g=!1);let j=h(this.EBML_ID.length,d.length-f);try{if(j<this.EBML_ID.length)throw"Unable to parse "+this._name+": Too few bytes";for(let a=0,b=this.EBML_ID.length;a<b;a++)if(d[f+a]!==this.EBML_ID[a])throw"Unable to parse "+this._name+": ID doesn't match"}catch(a){if(!g){c(d.slice(f-10,f+10));let e=[],g=[];for(let a=0;a<j;a++)e.push(d[f+a].toString(16).toUpperCase());for(let a=0;a<this.EBML_ID.length;a++)g.push(this.EBML_ID[a].toString(16).toUpperCase());b(a,"Given: ["+e.join(" "),"]   ID: [",g.join(" ")+"]")}return!1}this._position=f-1,f+=this.EBML_ID.length;let k=VInt.parse(d.slice(f,f+8));f+=k.bytesCount,this._contentLength=k.value,this._length=this.EBML_ID.length+k.bytesCount+(0<=k.value?k.value:0);let l=0<=k.value?k.value:d.length-f;switch(this._type){case WebM.TYPE_STRING:this.value=new TextDecoder("utf-8").decode(d.slice(f,f+l));break;case WebM.TYPE_INT:this.value=VInt.parse(d.slice(f,f+l)).value;break;case WebM.TYPE_UINT:this.value=VInt.parse(d.slice(f,f+l)).value;break;case WebM.TYPE_BINARY:this.value=d.slice(f,f+l);break;case WebM.TYPE_MASTER:let a=this._availableElements.slice(0),b=0;do{b=0;for(let c,e=0,g=a.length;e<g;e++)if(c=new a[e],c.parse(d,f,!1)){a.splice(e,1).slice(0),this[c._name]=c,f+=c._length,0>this._contentLength&&0<c._length&&(this._length+=c._length),b++;break}}while(0<b&&0<a.length);}return this.onParsingDone(d,f),!0}onParsingDone(a,b){}parseChildren(b,c,d,e){a("Parsing children ("+c.name+")");do{let a=new c;if(a.parse(d,e,!0)){e+=a._length,this._length+=a._length,this[b].push(a);continue}break}while(!0)}}class i extends h{constructor(){super("Header",e),this._availableElements=[j,k,l],this.EBML_ID=[26,69,223,163]}}class j extends h{constructor(){super("Version",f),this.value=void 0,this.EBML_ID=[66,134]}}class k extends h{constructor(){super("ReadVersion",f),this.value=void 0,this.EBML_ID=[66,247]}}class l extends h{constructor(){super("MaxIDLength",f),this.value=void 0,this.EBML_ID=[66,242]}}class m extends h{constructor(){super("SeekHead",e),this.seeks=[],this.EBML_ID=[17,77,155,116]}onParsingDone(a,b){this.parseChildren("seeks",n,a,b)}}class n extends h{constructor(){super("Seek",e),this._availableElements=[o,p],this.EBML_ID=[77,187]}}class o extends h{constructor(){super("SeekId",g),this.EBML_ID=[83,171]}}class p extends h{constructor(){super("SeekPosition",f),this.EBML_ID=[83,172]}}class q extends h{constructor(){super("Tracks",e),this.entries=[],this.EBML_ID=[22,84,174,107]}onParsingDone(a,b){this.parseChildren("entries",r,a,b)}}class r extends h{constructor(){super("TrackEntry",e),this._availableElements=[t,s,u,v],this.EBML_ID=[174]}}class s extends h{constructor(){super("TrackUID",f),this.EBML_ID=[115,197]}}class t extends h{constructor(){super("TrackNumber",f),this.EBML_ID=[215]}}class u extends h{constructor(){super("Video",e),this.EBML_ID=[224]}}class v extends h{constructor(){super("Audio",e),this.EBML_ID=[225]}}class w extends h{constructor(){super("Cues",e),this.EBML_ID=[28,83,187,107]}}class x extends h{constructor(){super("Cluster",e),this._availableElements=[y],this.simpleBlocks=[],this.EBML_ID=[31,67,182,117]}onParsingDone(a,b){this.parseChildren("simpleBlocks",z,a,b)}regenerateBytes(){let a=0,c=this.EBML_ID.length;c+=this.timestamp._length;for(let a=0,b=this.simpleBlocks.length;a<b;a++)c+=this.simpleBlocks[a]._length;let d=new Uint8Array(c);for(let b=0,c=this.EBML_ID.length;b<c;b++)d[a++]=this.EBML_ID[b];d[a++]=1,d[a++]=255,d[a++]=255,d[a++]=255,d[a++]=255,d[a++]=255,d[a++]=255,d[a++]=255;for(let b=0,c=this.timestamp.EBML_ID.length;b<c;b++)d[a++]=this.timestamp.EBML_ID[b];let b=VInt.createBytes(this.timestamp._contentLength);for(let c=0;c<b.length;c++)d[a++]=b[c];let e=WebM.intToBytes(this.timestamp.value);for(let b=0;b<e.length;b++)d[a++]=e[b];for(let b,c=0,e=this.simpleBlocks.length;c<e;c++){b=this.simpleBlocks[c];for(let c=0,e=b.EBML_ID.length;c<e;c++)d[a++]=b.EBML_ID[c];let e=VInt.createBytes(b._contentLength);for(let b=0;b<e.length;b++)d[a++]=e[b];for(let c=0,e=b.value.length;c<e;c++)d[a++]=b.value[c]}return d}}class y extends h{constructor(){super("Timestamp",f),this.EBML_ID=[231]}setValue(a){this.value=a,this._contentLength=Math.max(WebM.intToBytes(a).length,1),this._length=this.EBML_ID.length+1+this._contentLength}}class z extends h{constructor(){super("SimpleBlock",g),this.EBML_ID=[163]}}class A extends h{constructor(){super("Segment",e),this._availableElements=[m,B,q,w],this.clusters=[],this.EBML_ID=[24,83,128,103]}onParsingDone(a,b){this.parseChildren("clusters",x,a,b)}getLastCluster(){return this.clusters[this.clusters.length-1]}}class B extends h{constructor(){super("SegmentInfo",e),this._availableElements=[C],this.EBML_ID=[21,73,169,102]}}class C extends h{constructor(){super("SegmentUID",g),this.EBML_ID=[115,164]}}window.WebM=class{constructor(){this.header=new i,this.segment=new A}parse(b){a("Started..."),this.header.parse(b),this.header._length&&this.segment.parse(b,this.header._length)}},window.WebMCluster=x})();
//# sourceMappingURL=webm-parser.min.js.map
